<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>姓名卡片生成器-高级版</title>
    
    <!-- 外部库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <script src="js/pickr.min.js" id="pickr-script"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dom-to-image-more@3.1.6/dist/dom-to-image-more.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvg@3.0.10/lib/umd.min.js"></script>
    <link rel="stylesheet" href="css/classic.min.css">
    <link rel="stylesheet" href="iconfonts/iconfont.css">
    <script src="iconfonts/iconfont.js"></script>
    
    <!-- Pickr加载失败时的备用脚本 -->
    <script src="js/pickr-fallback.js"></script>
    
    <!-- 自定义样式 -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <!-- <link rel="stylesheet" href="css/layout.css"> -->
    <!-- <link rel="stylesheet" href="custom-fonts.css"> -->
    
    <!-- 自定义脚本 - 使用defer确保正确的加载顺序 -->
    <script src="js/core.js" defer></script>
    <script src="js/excel.js" defer></script>
    <script src="js/color-picker.js" defer></script>
    <script src="js/horizontal.js" defer></script>
    <script src="js/vertical.js" defer></script>
    <script src="js/image-save.js" defer></script>
    <script src="js/generator.js" defer></script>
    <script src="js/templates.js" defer></script>
    <script src="js/range-style.js" defer></script>
    <script src="font-preload.js" defer></script>
</head>
<body>
    <!-- 顶部工具栏 -->
    <div class="top-toolbar">
        <select id="backgroundMode" onchange="handleBackgroundModeChange(this.value)">
            <option value="light">浅色背景</option>
            <option value="dark">深色背景</option>
        </select>
    </div>

    <!-- 数据导入区 -->
    <div class="data-import-container">
        <label for="excelFile">导入文件:</label>
        <input type="file" id="excelFile" accept=".xlsx,.xls" />
        <span id="fileNameDisplay"></span>
        
        <div style="display:flex; align-items:center; gap:10px;">
            <select id="colNumber" class="column-select">
                <option value="">请选择列</option>
            </select>
            
            <select id="colName" class="column-select">
                <option value="">请选择列</option>
            </select>
            
            <select id="colUnit" class="column-select">
                <option value="">请选择列</option>
            </select>
            
            <button onclick="generateFixedNameCards()" class="action-btn">生成姓名条</button>
            <button onclick="saveAllNameCards()" class="action-btn">批量保存</button>
        </div>
    </div>

    <!-- 数据预览区 -->
    <div id="previewContainer" class="data-preview-section" style="display: none;">
        <div class="data-preview-header">数据预览</div>
        <table id="previewTable" class="preview-table"></table>
    </div>

    <!-- 模板切换按钮 -->
    <button class="template-toggle-btn" id="templateToggleBtn">显示模板库</button>
    
    <!-- 模板库 -->
    <div class="template-gallery" id="templateGallery">
        <h3 class="template-title">点击以下模板应用样式</h3>
        <div class="template-card" id="template1" onclick="applyTemplate('template1')">
            <div class="template-name">简约黑白</div>
        </div>

        <div class="template-card" id="template3" onclick="applyTemplate('template3')">
            <div class="template-name">商务金</div>
        </div>
        <div class="template-card" id="template4" onclick="applyTemplate('template4')">
            <div class="template-name">活力橙</div>
        </div>

        <div class="template-card" id="template6" onclick="applyTemplate('template6')">
            <div class="template-name">文艺雅致</div>
        </div>
        <div class="template-card" id="template7" onclick="applyTemplate('template7')">
            <div class="template-name">学术深蓝</div>
        </div>
        <div class="template-card" id="template8" onclick="applyTemplate('template8')">
            <div class="template-name">竖排中式</div>
        </div>
        <div class="template-card" id="template9" onclick="applyTemplate('template9')">
            <div class="template-name">透明简约</div>
        </div>

        <div class="template-card" id="template11" onclick="applyTemplate('template11')">
            <div class="template-name">优雅白</div>
        </div>
        <div class="template-card" id="template12" onclick="applyTemplate('template12')">
            <div class="template-name">现代黑</div>
        </div>
        <div class="template-card" id="template13" onclick="applyTemplate('template13')">
            <div class="template-name">紫色渐变</div>
        </div>
        <div class="template-card" id="template14" onclick="applyTemplate('template14')">
            <div class="template-name">自然绿</div>
        </div>
        <div class="template-card" id="template15" onclick="applyTemplate('template15')">
            <div class="template-name">企业红</div>
        </div>
        <div class="template-card" id="template16" onclick="applyTemplate('template16')">
            <div class="template-name">柔和粉彩</div>
        </div>
        <div class="template-card" id="template17" onclick="applyTemplate('template17')">
            <div class="template-name">科技斜切</div>
        </div>
        <div class="template-card" id="template18" onclick="applyTemplate('template18')">
            <div class="template-name">极简灰</div>
        </div>

        <div class="template-card" id="template20" onclick="applyTemplate('template20')">
            <div class="template-name">复古棕</div>
        </div>
        <div class="template-card" id="template21" onclick="applyTemplate('template21')">
            <div class="template-name">湖水青</div>
        </div>
        <div class="template-card" id="template22" onclick="applyTemplate('template22')">
            <div class="template-name">日落橙</div>
        </div>
        <div class="template-card" id="template23" onclick="applyTemplate('template23')">
            <div class="template-name">霓虹灯</div>
        </div>
        <div class="template-card" id="template24" onclick="applyTemplate('template24')">
            <div class="template-name">水墨风</div>
        </div>
        <div class="template-card" id="template25" onclick="applyTemplate('template25')">
            <div class="template-name">粉色花瓣</div>
        </div>
        <div class="template-card" id="template26" onclick="applyTemplate('template26')">
            <div class="template-name">翡翠绿</div>
        </div>
        <div class="template-card" id="template27" onclick="applyTemplate('template27')">
            <div class="template-name">深空蓝</div>
        </div>
        <div class="template-card" id="template28" onclick="applyTemplate('template28')">
            <div class="template-name">麦田金</div>
        </div>
        <div class="template-card" id="template29" onclick="applyTemplate('template29')">
            <div class="template-name">寂静夜</div>
        </div>
        <div class="template-card" id="template30" onclick="applyTemplate('template30')">
            <div class="template-name">珊瑚魅</div>
        </div>
    </div>

    <!-- 配置面板 -->
    <div class="config-panel">
        <!-- 全局设置工具栏 -->
        <div class="toolbar-container">
            <div class="toolbar-header">
                <h4>全局设置</h4>
            </div>
            
            <div class="modern-toolbar">
                <!-- 背景颜色 -->
                <div class="control-item">
                    <div id="globalBgColorPicker"></div>
                    <input type="color" id="globalBgColor" value="#ffffff" style="display:none;">
                </div>
                
                <!-- 渐变选择 -->
                <div class="control-item">
                    <select id="globalGradient" style="width:auto; min-width:100px; max-width:140px;">
                        <option value="none">无渐变</option>
                        <option value="tech-blue">科技蓝渐变</option>
                        <option value="vibrant-orange">活力橙渐变</option>
                        <option value="dream-purple">梦幻紫渐变</option>
                        <option value="nature-green">自然绿渐变</option>
                        <option value="glass-effect">玻璃态渐变</option>
                        <option value="dynamic-flow">动态流光渐变</option>
                        <option value="retro-film">复古电影渐变</option>
                        <option value="neon-effect">霓虹效果渐变</option>
                    </select>
                </div>
                
                <span class="divider"></span>
                
                <!-- 边框按钮组 -->
                <div class="toolbar-section">
                    <button id="globalBorderNoneBtn" class="icon-btn" onclick="toggleBorderStyle('global', 'none')" title="无边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-wubiankuang"></use></svg>
                    </button>
                    <button id="globalBorderBottomBtn" class="icon-btn" onclick="toggleBorderStyle('global', 'bottom')" title="下边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-xiabiankuang"></use></svg>
                    </button>
                    <button id="globalBorderTopBtn" class="icon-btn" onclick="toggleBorderStyle('global', 'top')" title="上边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-shangbiankuang"></use></svg>
                    </button>
                    <button id="globalBorderLeftBtn" class="icon-btn" onclick="toggleBorderStyle('global', 'left')" title="左边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-zuobiankuang"></use></svg>
                    </button>
                    <button id="globalBorderRightBtn" class="icon-btn" onclick="toggleBorderStyle('global', 'right')" title="右边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-youbiankuang"></use></svg>
                    </button>
                    <button id="globalBorderAllBtn" class="icon-btn" onclick="toggleBorderStyle('global', 'all')" title="外边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-waibiankuang"></use></svg>
                    </button>
                </div>
                
                <!-- 边框颜色和粗细 -->
                <div class="toolbar-section">
                    <div id="globalBorderColorPicker"></div>
                    <input type="color" id="globalBorderColor" value="#cccccc" style="display:none;">
                    <input type="number" id="globalBorderWidth" value="1" min="0" max="5" style="width: 45px;"> px
                </div>
                
                <span class="divider"></span>
                
                <!-- 布局与对齐 -->
                <div class="toolbar-section">
                    <button id="alignLeftBtn" class="icon-btn" onclick="setTextAlign('left')" title="左对齐">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-align-left"></use></svg>
                    </button>
                    <button id="alignCenterBtn" class="icon-btn" onclick="setTextAlign('center')" title="居中">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-align-center"></use></svg>
                    </button>
                    <button id="alignRightBtn" class="icon-btn" onclick="setTextAlign('right')" title="右对齐">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-align-right"></use></svg>
                    </button>
                </div>
                
                <span class="divider"></span>
                
                <!-- 排列方向 -->
                <div class="toolbar-section">
                    <button id="directionHorizontalBtn" class="icon-btn" onclick="setTextDirection('horizontal')" title="横排">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-hengpai"></use></svg>
                    </button>
                    <button id="directionVerticalBtn" class="icon-btn" onclick="setTextDirection('vertical')" title="竖排">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-shupai"></use></svg>
                    </button>
                    <div class="column-order-controls" style="display:none;">
                        <button id="columnOrderLeftToRightBtn" class="icon-btn active" onclick="updateColumnOrder('ltr')" title="从左到右排列">
                            <svg class="icon" aria-hidden="true"><use xlink:href="#icon-fangxiangzuo"></use></svg>
                        </button>
                        <button id="columnOrderRightToLeftBtn" class="icon-btn" onclick="updateColumnOrder('rtl')" title="从右到左排列">
                            <svg class="icon" aria-hidden="true"><use xlink:href="#icon-fangxiangyou"></use></svg>
                        </button>
                    </div>
                    <div class="vertical-align-controls" style="display:none;">
                        <button id="verticalAlignTopBtn" class="icon-btn" onclick="setVerticalAlign('top')" title="顶端对齐">
                            <svg class="icon" aria-hidden="true"><use xlink:href="#icon-verticalaligntop"></use></svg>
                        </button>
                        <button id="verticalAlignCenterBtn" class="icon-btn active" onclick="setVerticalAlign('middle')" title="居中对齐">
                            <svg class="icon" aria-hidden="true"><use xlink:href="#icon-verticalaligncenter"></use></svg>
                        </button>
                        <button id="verticalAlignBottomBtn" class="icon-btn" onclick="setVerticalAlign('bottom')" title="底部对齐">
                            <svg class="icon" aria-hidden="true"><use xlink:href="#icon-vertical-align-botto"></use></svg>
                        </button>
                    </div>
                </div>
                
                <span class="divider"></span>
                
                <!-- 间距设置 -->
                <div class="toolbar-section">
                    <label>间距:</label>
                    <input type="number" id="lineGap" value="0" min="0" max="40" style="width:45px;"> px
                </div>
                
                <!-- 层级控制 -->
                <div class="toolbar-section">
                    <label>号码层级:</label>
                    <input type="number" id="numberZ" value="1" min="1" max="3" style="width:40px;">
                    <label>姓名层级:</label>
                    <input type="number" id="nameZ" value="2" min="1" max="3" style="width:40px;">
                    <label>单位层级:</label>
                    <input type="number" id="unitZ" value="3" min="1" max="3" style="width:40px;">
                </div>
            </div>
        </div>

        <!-- 第一列设置工具栏 -->
        <div class="toolbar-container">
            <div class="modern-toolbar">
                <!-- 背景颜色 -->
                <div class="control-item">
                    <div id="numberBgColorPicker"></div>
                    <input type="color" id="numberBgColor" value="transparent" style="display:none;">
                </div>
                
                <!-- 渐变选择 -->
                <div class="control-item">
                    <select id="numberGradient" style="width:auto; min-width:100px; max-width:140px;">
                        <option value="none">无渐变</option>
                        <option value="tech-blue">科技蓝渐变</option>
                        <option value="vibrant-orange">活力橙渐变</option>
                        <option value="dream-purple">梦幻紫渐变</option>
                        <option value="nature-green">自然绿渐变</option>
                        <option value="glass-effect">玻璃态渐变</option>
                        <option value="dynamic-flow">动态流光渐变</option>
                        <option value="retro-film">复古电影渐变</option>
                        <option value="neon-effect">霓虹效果渐变</option>
                    </select>
                </div>
                
                <span class="divider"></span>
                
                <!-- 边框按钮组 -->
                <div class="toolbar-section">
                    <button id="numberBorderNoneBtn" class="icon-btn" onclick="toggleBorderStyle('number', 'none')" title="无边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-wubiankuang"></use></svg>
                    </button>
                    <button id="numberBorderBottomBtn" class="icon-btn" onclick="toggleBorderStyle('number', 'bottom')" title="下边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-xiabiankuang"></use></svg>
                    </button>
                    <button id="numberBorderTopBtn" class="icon-btn" onclick="toggleBorderStyle('number', 'top')" title="上边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-shangbiankuang"></use></svg>
                    </button>
                    <button id="numberBorderLeftBtn" class="icon-btn" onclick="toggleBorderStyle('number', 'left')" title="左边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-zuobiankuang"></use></svg>
                    </button>
                    <button id="numberBorderRightBtn" class="icon-btn" onclick="toggleBorderStyle('number', 'right')" title="右边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-youbiankuang"></use></svg>
                    </button>
                    <button id="numberBorderAllBtn" class="icon-btn" onclick="toggleBorderStyle('number', 'all')" title="外边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-waibiankuang"></use></svg>
                    </button>
                </div>
                
                <!-- 边框颜色和粗细 -->
                <div class="toolbar-section">
                    <div id="numberBorderColorPicker"></div>
                    <input type="color" id="numberBorderColor" value="#cccccc" style="display:none;">
                    <input type="number" id="numberBorderWidth" value="1" min="0" max="5" style="width: 45px;"> px
                </div>
                
                <span class="divider"></span>
                
                <!-- 文字颜色、字体、大小和样式 -->
                <div class="toolbar-section">
                    <div id="numberTextColorPicker"></div>
                    <input type="color" id="numberTextColor" value="#000000" style="display:none;">
                    <select id="numberFontFamily" style="width:auto; min-width:100px; max-width:150px;">
                        <option value="微软雅黑">微软雅黑</option>
                        <option value="宋体">宋体</option>
                        <option value="Arial">Arial</option>
                        <option value="Times New Roman">Times New Roman</option>
                        <option value="Calibri">Calibri</option>
                        <option value="Consolas">Consolas</option>
                        <option value="Georgia">Georgia</option>
                        <option value="Verdana">Verdana</option>
                        <option value="KuaikanShijie" class="font-option-kuaikanshijie">快看世界体</option>
                        <option value="JiangXiZhuoKai" class="font-option-jiangxizhuokai">江西拙楷</option>
                        <option value="HuXiaoBoZhenShuai" class="font-option-huxiaobozhenshuai">胡晓波真帅体</option>
                        <option value="FangZhengFangSong" class="font-option-fangzhengfangsong">方正仿宋</option>
                        <option value="OPPOSans" class="font-option-opposans">OPPO Sans</option>
                        <option value="MiSans-VF" class="font-option-MisanVF">MiSan VF</option>
                        <option value="AlibabaPuHuiTi" class="font-option-alibabapuhui">阿里巴巴普惠体</option>
                        <option value="LuoxiaXinxiHei" class="font-option-luoxiaxinxihei">落霞新晰黑+</option>
                        <option value="SmileySans" class="font-option-smileysans">得意黑</option>
                    </select>
                    <input type="number" id="numberFontSize" class="font-size-input" value="24" min="8" max="72" style="width:45px;">
                    <button id="numberBoldBtn" class="icon-btn" onclick="toggleTextStyle('bold', 'number')" title="粗体">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-bold"></use></svg>
                    </button>
                    <button id="numberItalicBtn" class="icon-btn" onclick="toggleTextStyle('italic', 'number')" title="斜体">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-italic"></use></svg>
                    </button>
                    <button id="numberUnderlineBtn" class="icon-btn" onclick="toggleTextStyle('underline', 'number')" title="下划线">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-underline"></use></svg>
                    </button>
                </div>
                
                <span class="divider"></span>
                
                <!-- 描边设置 -->
                <div class="toolbar-section">
                    <div id="numberStrokeColorPicker"></div>
                    <input type="color" id="numberStrokeColor" value="#000000" style="display:none;">
                    <input type="number" id="numberStrokeWidth" value="0" min="0" max="8" step="1" style="width:45px;"> px
                </div>
                
                <span class="divider"></span>
                
                <!-- 阴影设置 -->
                <div class="toolbar-section">
                    <div id="numberShadowColorPicker"></div>
                    <input type="color" id="numberShadowColor" value="#000000" style="display:none;">
                    <span>X:</span>
                    <input type="number" id="numberShadowX" class="shadow-input" value="0" min="-10" max="10" style="width:45px;">
                    <span>Y:</span>
                    <input type="number" id="numberShadowY" class="shadow-input" value="0" min="-10" max="10" style="width:45px;">
                    <span>模糊:</span>
                    <input type="number" id="numberShadowBlur" class="shadow-input" value="0" min="0" max="10" style="width:45px;">
                </div>
                
                <span class="divider"></span>
                
                <!-- 第一列（号码）的形状设置 -->
                <div class="toolbar-section">
                    <span>圆角:</span>
                    <input type="number" id="numberBorderRadius" value="0" min="0" max="50" style="width:45px;"> px
                    <span>斜角:</span>
                    <input type="number" id="numberSkewAngle" value="0" min="-45" max="45" style="width:45px;"> 度
                </div>
                
                <!-- 第一列（号码）的长度和位置设置 -->
                <div class="toolbar-section">
                    <span>长度:</span>
                    <input type="number" id="numberLength" value="100" min="0" max="500" style="width:45px;"> px
                    <span>X偏移:</span>
                    <input type="number" id="numberOffsetX" value="0" min="-100" max="100" style="width:45px;"> px
                    <span>Y偏移:</span>
                    <input type="number" id="numberOffsetY" value="0" min="-100" max="100" style="width:45px;"> px
                </div>
                
                <span class="divider"></span>
                
                <!-- 边框渐变 -->
                <div class="toolbar-section">
                    <select id="numberBorderGradient" style="width:auto; min-width:120px;">
                        <option value="none">无边框渐变</option>
                        <option value="horizontal">水平渐变</option>
                        <option value="vertical">垂直渐变</option>
                        <option value="diagonal">对角渐变</option>
                    </select>
                    <div id="numberBorderGradientStartColorPicker"></div>
                    <input type="color" id="numberBorderGradientStartColor" value="#cccccc" style="display:none;">
                    <div id="numberBorderGradientEndColorPicker"></div>
                    <input type="color" id="numberBorderGradientEndColor" value="#000000" style="display:none;">
                </div>
            </div>
        </div>
        
        <!-- 第二列设置工具栏 -->
        <div class="toolbar-container">
            <div class="modern-toolbar">
                <!-- 背景颜色 -->
                <div class="control-item">
                    <div id="nameBgColorPicker"></div>
                    <input type="color" id="nameBgColor" value="transparent" style="display:none;">
                </div>
                
                <!-- 渐变选择 -->
                <div class="control-item">
                    <select id="nameGradient" style="width:auto; min-width:100px; max-width:140px;">
                        <option value="none">无渐变</option>
                        <option value="tech-blue">科技蓝渐变</option>
                        <option value="vibrant-orange">活力橙渐变</option>
                        <option value="dream-purple">梦幻紫渐变</option>
                        <option value="nature-green">自然绿渐变</option>
                        <option value="glass-effect">玻璃态渐变</option>
                        <option value="dynamic-flow">动态流光渐变</option>
                        <option value="retro-film">复古电影渐变</option>
                        <option value="neon-effect">霓虹效果渐变</option>
                    </select>
                </div>
                
                <span class="divider"></span>
                
                <!-- 边框按钮组 -->
                <div class="toolbar-section">
                    <button id="nameBorderNoneBtn" class="icon-btn" onclick="toggleBorderStyle('name', 'none')" title="无边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-wubiankuang"></use></svg>
                    </button>
                    <button id="nameBorderBottomBtn" class="icon-btn" onclick="toggleBorderStyle('name', 'bottom')" title="下边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-xiabiankuang"></use></svg>
                    </button>
                    <button id="nameBorderTopBtn" class="icon-btn" onclick="toggleBorderStyle('name', 'top')" title="上边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-shangbiankuang"></use></svg>
                    </button>
                    <button id="nameBorderLeftBtn" class="icon-btn" onclick="toggleBorderStyle('name', 'left')" title="左边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-zuobiankuang"></use></svg>
                    </button>
                    <button id="nameBorderRightBtn" class="icon-btn" onclick="toggleBorderStyle('name', 'right')" title="右边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-youbiankuang"></use></svg>
                    </button>
                    <button id="nameBorderAllBtn" class="icon-btn" onclick="toggleBorderStyle('name', 'all')" title="外边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-waibiankuang"></use></svg>
                    </button>
                </div>
                
                <!-- 边框颜色和粗细 -->
                <div class="toolbar-section">
                    <div id="nameBorderColorPicker"></div>
                    <input type="color" id="nameBorderColor" value="#cccccc" style="display:none;">
                    <input type="number" id="nameBorderWidth" value="1" min="0" max="5" style="width: 45px;"> px
                </div>
                
                <span class="divider"></span>
                
                <!-- 文字颜色、字体、大小和样式 -->
                <div class="toolbar-section">
                    <div id="nameTextColorPicker"></div>
                    <input type="color" id="nameTextColor" value="#000000" style="display:none;">
                    <select id="nameFontFamily" style="width:auto; min-width:100px; max-width:150px;">
                        <option value="微软雅黑">微软雅黑</option>
                        <option value="宋体">宋体</option>
                        <option value="Arial">Arial</option>
                        <option value="Times New Roman">Times New Roman</option>
                        <option value="Calibri">Calibri</option>
                        <option value="Consolas">Consolas</option>
                        <option value="Georgia">Georgia</option>
                        <option value="Verdana">Verdana</option>
                        <option value="IYanTi" class="font-option-kuaikanshijie">快看世界体</option>
                        <option value="JiangXiZhuoKai" class="font-option-jiangxizhuokai">江西拙楷</option>
                        <option value="HuXiaoBoZhenShuai" class="font-option-huxiaobozhenshuai">胡晓波真帅体</option>
                        <option value="FangZhengFangSong" class="font-option-fangzhengfangsong">方正仿宋</option>
                        <option value="OPPOSans" class="font-option-opposans">OPPO Sans</option>
                        <option value="MiSans-VF" class="font-option-MisanVF">MiSan VF</option>
                        <option value="AlibabaPuHuiTi" class="font-option-alibabapuhui">阿里巴巴普惠体</option>
                        <option value="LuoxiaXinxiHei" class="font-option-luoxiaxinxihei">落霞新晰黑+</option>
                        <option value="SmileySans" class="font-option-smileysans">得意黑</option>
                    </select>
                    <input type="number" id="nameFontSize" class="font-size-input" value="32" min="8" max="72" style="width:45px;">
                    <button id="nameBoldBtn" class="icon-btn" onclick="toggleTextStyle('bold', 'name')" title="粗体">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-bold"></use></svg>
                    </button>
                    <button id="nameItalicBtn" class="icon-btn" onclick="toggleTextStyle('italic', 'name')" title="斜体">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-italic"></use></svg>
                    </button>
                    <button id="nameUnderlineBtn" class="icon-btn" onclick="toggleTextStyle('underline', 'name')" title="下划线">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-underline"></use></svg>
                    </button>
                </div>

                <!-- 文字范围样式控制 -->
                <div class="toolbar-section">
                    <span>文字范围样式:</span>
                    <input type="number" id="nameRangeStart" value="1" min="1" max="10" style="width:45px;" placeholder="起始">
                    <span>到</span>
                    <input type="number" id="nameRangeEnd" value="1" min="1" max="10" style="width:45px;" placeholder="结束">
                    <input type="number" id="nameRangeFontSize" value="32" min="8" max="72" style="width:45px;" placeholder="字号">
                    <button id="nameRangeBoldBtn" class="icon-btn" onclick="toggleRangeTextStyle('bold', 'name')" title="粗体">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-bold"></use></svg>
                    </button>
                    <button id="nameRangeApplyBtn" class="icon-btn" onclick="applyRangeStyle('name')" title="应用">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-check"></use></svg>
                    </button>
                </div>
                
                <span class="divider"></span>
                
                <!-- 描边设置 -->
                <div class="toolbar-section">
                    <div id="nameStrokeColorPicker"></div>
                    <input type="color" id="nameStrokeColor" value="#000000" style="display:none;">
                    <input type="number" id="nameStrokeWidth" value="0" min="0" max="8" step="1" style="width:45px;"> px
                </div>
                
                <span class="divider"></span>
                
                <!-- 阴影设置 -->
                <div class="toolbar-section">
                    <div id="nameShadowColorPicker"></div>
                    <input type="color" id="nameShadowColor" value="#000000" style="display:none;">
                    <span>X:</span>
                    <input type="number" id="nameShadowX" class="shadow-input" value="0" min="-10" max="10" style="width:45px;">
                    <span>Y:</span>
                    <input type="number" id="nameShadowY" class="shadow-input" value="0" min="-10" max="10" style="width:45px;">
                    <span>模糊:</span>
                    <input type="number" id="nameShadowBlur" class="shadow-input" value="0" min="0" max="10" style="width:45px;">
                </div>
                
                <span class="divider"></span>
                
                <!-- 第二列（姓名）的形状设置 -->
                <div class="toolbar-section">
                    <span>圆角:</span>
                    <input type="number" id="nameBorderRadius" value="0" min="0" max="50" style="width:45px;"> px
                    <span>斜角:</span>
                    <input type="number" id="nameSkewAngle" value="0" min="-45" max="45" style="width:45px;"> 度
                </div>
                
                <!-- 第二列（姓名）的长度和位置设置 -->
                <div class="toolbar-section">
                    <span>长度:</span>
                    <input type="number" id="nameLength" value="100" min="0" max="500" style="width:45px;"> px
                    <span>X偏移:</span>
                    <input type="number" id="nameOffsetX" value="0" min="-100" max="100" style="width:45px;"> px
                    <span>Y偏移:</span>
                    <input type="number" id="nameOffsetY" value="0" min="-100" max="100" style="width:45px;"> px
                </div>
                
                <span class="divider"></span>
                
                <!-- 边框渐变 -->
                <div class="toolbar-section">
                    <select id="nameBorderGradient" style="width:auto; min-width:120px;">
                        <option value="none">无边框渐变</option>
                        <option value="horizontal">水平渐变</option>
                        <option value="vertical">垂直渐变</option>
                        <option value="diagonal">对角渐变</option>
                    </select>
                    <div id="nameBorderGradientStartColorPicker"></div>
                    <input type="color" id="nameBorderGradientStartColor" value="#cccccc" style="display:none;">
                    <div id="nameBorderGradientEndColorPicker"></div>
                    <input type="color" id="nameBorderGradientEndColor" value="#000000" style="display:none;">
                </div>
            </div>
        </div>
        
        <!-- 第三列设置工具栏 -->
        <div class="toolbar-container">          
            <div class="modern-toolbar">
                <!-- 背景颜色 -->
                <div class="control-item">
                    <div id="unitBgColorPicker"></div>
                    <input type="color" id="unitBgColor" value="transparent" style="display:none;">
                </div>
                
                <!-- 渐变选择 -->
                <div class="control-item">
                    <select id="unitGradient" style="width:auto; min-width:100px; max-width:140px;">
                        <option value="none">无渐变</option>
                        <option value="tech-blue">科技蓝渐变</option>
                        <option value="vibrant-orange">活力橙渐变</option>
                        <option value="dream-purple">梦幻紫渐变</option>
                        <option value="nature-green">自然绿渐变</option>
                        <option value="glass-effect">玻璃态渐变</option>
                        <option value="dynamic-flow">动态流光渐变</option>
                        <option value="retro-film">复古电影渐变</option>
                        <option value="neon-effect">霓虹效果渐变</option>
                    </select>
                </div>
                
                <span class="divider"></span>
                
                <!-- 边框按钮组 -->
                <div class="toolbar-section">
                    <button id="unitBorderNoneBtn" class="icon-btn" onclick="toggleBorderStyle('unit', 'none')" title="无边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-wubiankuang"></use></svg>
                    </button>
                    <button id="unitBorderBottomBtn" class="icon-btn" onclick="toggleBorderStyle('unit', 'bottom')" title="下边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-xiabiankuang"></use></svg>
                    </button>
                    <button id="unitBorderTopBtn" class="icon-btn" onclick="toggleBorderStyle('unit', 'top')" title="上边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-shangbiankuang"></use></svg>
                    </button>
                    <button id="unitBorderLeftBtn" class="icon-btn" onclick="toggleBorderStyle('unit', 'left')" title="左边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-zuobiankuang"></use></svg>
                    </button>
                    <button id="unitBorderRightBtn" class="icon-btn" onclick="toggleBorderStyle('unit', 'right')" title="右边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-youbiankuang"></use></svg>
                    </button>
                    <button id="unitBorderAllBtn" class="icon-btn" onclick="toggleBorderStyle('unit', 'all')" title="外边框">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-waibiankuang"></use></svg>
                    </button>
                </div>
                
                <!-- 边框颜色和粗细 -->
                <div class="toolbar-section">
                    <div id="unitBorderColorPicker"></div>
                    <input type="color" id="unitBorderColor" value="#cccccc" style="display:none;">
                    <input type="number" id="unitBorderWidth" value="1" min="0" max="5" style="width: 45px;"> px
                </div>
                
                <span class="divider"></span>
                
                <!-- 文字颜色、字体、大小和样式 -->
                <div class="toolbar-section">
                    <div id="unitTextColorPicker"></div>
                    <input type="color" id="unitTextColor" value="#000000" style="display:none;">
                    <select id="unitFontFamily" style="width:auto; min-width:100px; max-width:150px;">
                        <option value="微软雅黑">微软雅黑</option>
                        <option value="宋体">宋体</option>
                        <option value="Arial">Arial</option>
                        <option value="Times New Roman">Times New Roman</option>
                        <option value="Calibri">Calibri</option>
                        <option value="Consolas">Consolas</option>
                        <option value="Georgia">Georgia</option>
                        <option value="Verdana">Verdana</option>
                        <option value="KuaikanShijie" class="font-option-kuaikanshijie">快看世界体</option>
                        <option value="JiangXiZhuoKai" class="font-option-jiangxizhuokai">江西拙楷</option>
                        <option value="HuXiaoBoZhenShuai" class="font-option-huxiaobozhenshuai">胡晓波真帅体</option>
                        <option value="FangZhengFangSong" class="font-option-fangzhengfangsong">方正仿宋</option>
                        <option value="OPPOSans" class="font-option-opposans">OPPO Sans</option>
                        <option value="MiSans-VF" class="font-option-MisanVF">MiSan VF</option>
                        <option value="AlibabaPuHuiTi" class="font-option-alibabapuhui">阿里巴巴普惠体</option>
                        <option value="LuoxiaXinxiHei" class="font-option-luoxiaxinxihei">落霞新晰黑+</option>
                        <option value="SmileySans" class="font-option-smileysans">得意黑</option>
                    </select>
                    <input type="number" id="unitFontSize" class="font-size-input" value="20" min="8" max="72" style="width:45px;">
                    <button id="unitBoldBtn" class="icon-btn" onclick="toggleTextStyle('bold', 'unit')" title="粗体">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-bold"></use></svg>
                    </button>
                    <button id="unitItalicBtn" class="icon-btn" onclick="toggleTextStyle('italic', 'unit')" title="斜体">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-italic"></use></svg>
                    </button>
                    <button id="unitUnderlineBtn" class="icon-btn" onclick="toggleTextStyle('underline', 'unit')" title="下划线">
                        <svg class="icon" aria-hidden="true"><use xlink:href="#icon-underline"></use></svg>
                    </button>
                </div>
                
                <span class="divider"></span>
                
                <!-- 描边设置 -->
                <div class="toolbar-section">
                    <div id="unitStrokeColorPicker"></div>
                    <input type="color" id="unitStrokeColor" value="#000000" style="display:none;">
                    <input type="number" id="unitStrokeWidth" value="0" min="0" max="8" step="1" style="width:45px;"> px
                </div>
                
                <span class="divider"></span>
                
                <!-- 阴影设置 -->
                <div class="toolbar-section">
                    <div id="unitShadowColorPicker"></div>
                    <input type="color" id="unitShadowColor" value="#000000" style="display:none;">
                    <span>X:</span>
                    <input type="number" id="unitShadowX" class="shadow-input" value="0" min="-10" max="10" style="width:45px;">
                    <span>Y:</span>
                    <input type="number" id="unitShadowY" class="shadow-input" value="0" min="-10" max="10" style="width:45px;">
                    <span>模糊:</span>
                    <input type="number" id="unitShadowBlur" class="shadow-input" value="0" min="0" max="10" style="width:45px;">
                </div>
                
                <span class="divider"></span>
                
                <!-- 第三列（单位）的形状设置 -->
                <div class="toolbar-section">
                    <span>圆角:</span>
                    <input type="number" id="unitBorderRadius" value="0" min="0" max="50" style="width:45px;"> px
                    <span>斜角:</span>
                    <input type="number" id="unitSkewAngle" value="0" min="-45" max="45" style="width:45px;"> 度
                </div>
                
                <!-- 第三列（单位）的长度和位置设置 -->
                <div class="toolbar-section">
                    <span>长度:</span>
                    <input type="number" id="unitLength" value="100" min="0" max="500" style="width:45px;"> px
                    <span>X偏移:</span>
                    <input type="number" id="unitOffsetX" value="0" min="-100" max="100" style="width:45px;"> px
                    <span>Y偏移:</span>
                    <input type="number" id="unitOffsetY" value="0" min="-100" max="100" style="width:45px;"> px
                </div>
                
                <span class="divider"></span>
                
                <!-- 边框渐变 -->
                <div class="toolbar-section">
                    <select id="unitBorderGradient" style="width:auto; min-width:120px;">
                        <option value="none">无边框渐变</option>
                        <option value="horizontal">水平渐变</option>
                        <option value="vertical">垂直渐变</option>
                        <option value="diagonal">对角渐变</option>
                    </select>
                    <div id="unitBorderGradientStartColorPicker"></div>
                    <input type="color" id="unitBorderGradientStartColor" value="#cccccc" style="display:none;">
                    <div id="unitBorderGradientEndColorPicker"></div>
                    <input type="color" id="unitBorderGradientEndColor" value="#000000" style="display:none;">
                </div>
            </div>
        </div>
    </div>

    <!-- 生成结果容器 -->
    <div id="container" class="light-mode">
        <!-- 卡片将在这里生成 -->
    </div>

    <!-- 修复竖排模式列排序功能 -->
    <script>
    // 更强大的列排序更新函数 - 直接操作DOM元素
    window.updateColumnOrder = function(order) {
        if (order !== 'ltr' && order !== 'rtl') return;
        
        // 更新配置
        window.styleConfig.columnOrder = order;
        
        // 更新按钮状态
        const ltrBtn = document.getElementById('columnOrderLeftToRightBtn');
        const rtlBtn = document.getElementById('columnOrderRightToLeftBtn');
        
        if (ltrBtn) ltrBtn.classList.toggle('active', order === 'ltr');
        if (rtlBtn) rtlBtn.classList.toggle('active', order === 'rtl');
        
        // 找到所有竖排模式的卡片
        const cards = document.querySelectorAll('.vertical-mode');
        
        // 遍历每张卡片，重新排序子元素
        cards.forEach(card => {
            // 收集当前卡片的所有列元素
            const columns = Array.from(card.children).filter(el => 
                el.classList.contains('name-line') || 
                el.classList.contains('number-line') || 
                el.classList.contains('unit-line')
            );
            
            // 临时从卡片中移除所有列元素
            columns.forEach(col => card.removeChild(col));
            
            // 确定元素的自然顺序: number, name, unit
            columns.sort((a, b) => {
                const aType = a.classList.contains('number') ? 0 : (a.classList.contains('name') ? 1 : 2);
                const bType = b.classList.contains('number') ? 0 : (b.classList.contains('name') ? 1 : 2);
                return aType - bType;
            });
            
            // 如果是RTL排序，反转元素顺序
            if (order === 'rtl') {
                columns.reverse();
            }
            
            // 按照排序后的顺序重新添加元素
            columns.forEach(col => card.appendChild(col));
            
            // 设置卡片的data属性，方便调试
            card.dataset.columnOrder = order;
        });
    };
    
    // 背景模式切换处理函数
    function handleBackgroundModeChange(mode) {
        if (mode === 'dark') {
            setBackgroundMode('dark');
        } else {
            setBackgroundMode('light');
        }
    }
    
    // 页面加载时设置下拉框初始值
    document.addEventListener('DOMContentLoaded', function() {
        // 初始化配置
        document.getElementById('excelFile').addEventListener('change', handleFixedExcelFile);
        
        // 初始化颜色选择器
        initPickrColorPickers();
        
        // 添加列选择器事件监听器
        document.getElementById('colNumber').addEventListener('change', updateIfDataLoaded);
        document.getElementById('colName').addEventListener('change', updateIfDataLoaded);
        document.getElementById('colUnit').addEventListener('change', updateIfDataLoaded);
        
        // 获取当前背景模式并设置下拉框
        const currentMode = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
        document.getElementById('backgroundMode').value = currentMode;
        
        // 初始化模板预览
        initializeTemplatePreview();
    });

    // 初始化脚本
    document.addEventListener('DOMContentLoaded', function() {
        // 检查Pickr库是否已加载
        if (typeof Pickr === 'undefined') {
            console.warn('Pickr库未加载，使用备用加载方式');
            // 加载备用脚本处理（已在pickr-fallback.js中实现）
        } else {
            console.log('Pickr库已成功加载');
            
            // 初始化应用程序
            try {
                if (typeof initPickrColorPickers === 'function') {
                    initPickrColorPickers();
                }
                
                // 显示模板库按钮的点击事件处理
                const templateToggleBtn = document.getElementById('templateToggleBtn');
                const templateGallery = document.getElementById('templateGallery');
                
                if (templateToggleBtn && templateGallery) {
                    templateToggleBtn.addEventListener('click', function() {
                        templateGallery.classList.toggle('active');
                        templateToggleBtn.textContent = templateGallery.classList.contains('active') 
                            ? '隐藏模板库' 
                            : '显示模板库';
                    });
                }
                
                // 初始化模板预览
                if (typeof initializeTemplatePreview === 'function') {
                    // 延迟执行，确保DOM和样式加载完成
                    setTimeout(initializeTemplatePreview, 500);
                }
            } catch (error) {
                console.error('初始化应用程序时出错:', error);
            }
        }
    });
    </script>
</body>
</html> 